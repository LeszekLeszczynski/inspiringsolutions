{"paragraphs":[{"text":"%md\n## Zeppelin tutorial\n\nIn this tutorial, we will learn how to use various Zeppelin features to access and analyse the transactional data in HDFS. \n\nThe code in a Zeppelin notebook is divided into paragraphs. Each paragraph contains a portion of code that can be ran against the selected interpreter. The interpreter reference is the first line of the paragraph - you can choose one of:\n\n* %spark - spark/ Scala\n* %pyspark - spark/ Python\n* %sql - spark SQL\n* %sh - shell\n* %md - markdown\n\nEdit the paragraph code and run it with Ctrl-Return or arrow icon.","user":"admin","dateUpdated":"2017-03-28T12:55:11+0000","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/markdown","editorHide":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490703066936_1387389437","id":"20170328-121106_367650013","dateCreated":"2017-03-28T12:11:06+0000","dateStarted":"2017-03-28T12:55:09+0000","dateFinished":"2017-03-28T12:55:09+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:155"},{"title":"A shell paragraph allows you to run shell commands, e.g. to load data from public sources.","text":"%sh\n\nif [ ! -f kody.csv.zip ]; then\n  wget http://www.kody-pocztowe.dokladnie.com/kody.csv.zip\nfi\n\nunzip -o kody.csv.zip","user":"user1","dateUpdated":"2017-03-31T13:55:40+0000","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/sh","title":true,"tableHide":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490702381534_560538859","id":"20170328-115941_1817472551","result":{"code":"SUCCESS","type":"TEXT","msg":"Archive:  kody.csv.zip\n  inflating: kody.csv                \n"},"dateCreated":"2017-03-28T11:59:41+0000","dateStarted":"2017-03-31T11:55:45+0000","dateFinished":"2017-03-31T11:55:46+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:156"},{"title":"Let's load the downloaded data into a Spark dataframe","text":"%pyspark\n\nfile = open(\"/home/zeppelin/kody.csv\")\n\n# parallelize the local file content\n# sc refers to Spark context\nlines = sc.parallelize(file.readlines()[1:])    # omit header with [1:]\n\n# convert the input files into a dataframe\nparts = lines.map(lambda l: l.decode(\"UTF-8\").strip().split(\";\"))\nkody = parts.map(lambda p: Row(kod=p[0], wojewodztwo=p[3])) # we only care about code-voivodship mapping\n\nkody_df = sqlContext.createDataFrame(kody).distinct() # distinct() is needed because there are repeating rows in the dataset\n\n# register the dataframe as temporary table\nkody_df.registerTempTable(\"KODY\")","user":"admin","dateUpdated":"2017-03-31T13:55:41+0000","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"title":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490702963439_-1884499886","id":"20170328-120923_637036783","dateCreated":"2017-03-28T12:09:23+0000","dateStarted":"2017-03-28T01:41:23+0000","dateFinished":"2017-03-28T01:41:23+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:157"},{"title":"Use %sql interpreter to run SQL queries","text":"%sql\nselect * from kody","user":"admin","dateUpdated":"2017-03-30T07:24:04+0000","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"adres","index":0,"aggr":"sum"}],"values":[{"name":"kod","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"adres","index":0,"aggr":"sum"},"yAxis":{"name":"kod","index":1,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/sql","title":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490703771973_-913429244","id":"20170328-122251_74042159","dateCreated":"2017-03-28T12:22:51+0000","dateStarted":"2017-03-28T01:41:27+0000","dateFinished":"2017-03-28T01:41:27+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:158"},{"title":"Let's see what tables are available","text":"%sql\nshow tables in bzwbk","user":"admin","dateUpdated":"2017-03-29T07:59:30+0000","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"title":true,"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490704697612_-2068172372","id":"20170328-123817_461144851","dateCreated":"2017-03-28T12:38:17+0000","dateStarted":"2017-03-28T12:51:19+0000","dateFinished":"2017-03-28T12:51:19+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:159"},{"title":"Let's check the \"klient\" table structure","text":"%sql\ndescribe bzwbk.klient","user":"user1","dateUpdated":"2017-03-31T13:05:15+0000","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"col_name","index":0,"aggr":"sum"}],"values":[{"name":"data_type","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"col_name","index":0,"aggr":"sum"},"yAxis":{"name":"data_type","index":1,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/sql","title":true,"tableHide":false},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490705479374_-1300482824","id":"20170328-125119_804131283","result":{"code":"SUCCESS","type":"TABLE","msg":"col_name\tdata_type\tcomment\nklient_id\tint\tnull\nstan_cyw\tstring\tnull\nwyksztalcenie\tstring\tnull\nliczba_osob_gosp\tint\tnull\ndochod\tdouble\tnull\nposiada_nieruchomosc\tint\tnull\ntyp_dochodu\tint\tnull\nwiek\tint\tnull\nstaz_klient\tint\tnull\nkod_pocztowy\tstring\tnull\nkraj\tstring\tnull\nliczba_rach_k_kred\tint\tnull\nliczba_trans_k_kred\tint\tnull\nkwota_trans_k_kred\tdouble\tnull\nliczba_k_deb\tint\tnull\nliczba_wyplat_k_deb_atm\tint\tnull\nliczba_plat_k_deb\tint\tnull\nkwota_trans_k_deb\tdouble\tnull\nliczba_rach_biez\tint\tnull\nliczba_trans_rach_biez\tint\tnull\nkwota_trans_rach_biez\tdouble\tnull\nliczba_prod_kred\tint\tnull\nliczba_prod_oszcz\tint\tnull\nokres\tstring\tnull\n# Partition Information\t\t\n# col_name\tdata_type\tcomment\nokres\tstring\tnull\n","comment":"","msgTable":[[{"key":"data_type","value":"klient_id"},{"key":"data_type","value":"int"},{"key":"data_type","value":"null"}],[{"key":"comment","value":"stan_cyw"},{"key":"comment","value":"string"},{"key":"comment","value":"null"}],[{"value":"wyksztalcenie"},{"value":"string"},{"value":"null"}],[{"value":"liczba_osob_gosp"},{"value":"int"},{"value":"null"}],[{"value":"dochod"},{"value":"double"},{"value":"null"}],[{"value":"posiada_nieruchomosc"},{"value":"int"},{"value":"null"}],[{"value":"typ_dochodu"},{"value":"int"},{"value":"null"}],[{"value":"wiek"},{"value":"int"},{"value":"null"}],[{"value":"staz_klient"},{"value":"int"},{"value":"null"}],[{"value":"kod_pocztowy"},{"value":"string"},{"value":"null"}],[{"value":"kraj"},{"value":"string"},{"value":"null"}],[{"value":"liczba_rach_k_kred"},{"value":"int"},{"value":"null"}],[{"value":"liczba_trans_k_kred"},{"value":"int"},{"value":"null"}],[{"value":"kwota_trans_k_kred"},{"value":"double"},{"value":"null"}],[{"value":"liczba_k_deb"},{"value":"int"},{"value":"null"}],[{"value":"liczba_wyplat_k_deb_atm"},{"value":"int"},{"value":"null"}],[{"value":"liczba_plat_k_deb"},{"value":"int"},{"value":"null"}],[{"value":"kwota_trans_k_deb"},{"value":"double"},{"value":"null"}],[{"value":"liczba_rach_biez"},{"value":"int"},{"value":"null"}],[{"value":"liczba_trans_rach_biez"},{"value":"int"},{"value":"null"}],[{"value":"kwota_trans_rach_biez"},{"value":"double"},{"value":"null"}],[{"value":"liczba_prod_kred"},{"value":"int"},{"value":"null"}],[{"value":"liczba_prod_oszcz"},{"value":"int"},{"value":"null"}],[{"value":"okres"},{"value":"string"},{"value":"null"}],[{"value":"# Partition Information"},{"value":""},{"value":""}],[{"value":"# col_name"},{"value":"data_type"},{"value":"comment"}],[{"value":"okres"},{"value":"string"},{"value":"null"}]],"columnNames":[{"name":"col_name","index":0,"aggr":"sum"},{"name":"data_type","index":1,"aggr":"sum"},{"name":"comment","index":2,"aggr":"sum"}],"rows":[["klient_id","int","null"],["stan_cyw","string","null"],["wyksztalcenie","string","null"],["liczba_osob_gosp","int","null"],["dochod","double","null"],["posiada_nieruchomosc","int","null"],["typ_dochodu","int","null"],["wiek","int","null"],["staz_klient","int","null"],["kod_pocztowy","string","null"],["kraj","string","null"],["liczba_rach_k_kred","int","null"],["liczba_trans_k_kred","int","null"],["kwota_trans_k_kred","double","null"],["liczba_k_deb","int","null"],["liczba_wyplat_k_deb_atm","int","null"],["liczba_plat_k_deb","int","null"],["kwota_trans_k_deb","double","null"],["liczba_rach_biez","int","null"],["liczba_trans_rach_biez","int","null"],["kwota_trans_rach_biez","double","null"],["liczba_prod_kred","int","null"],["liczba_prod_oszcz","int","null"],["okres","string","null"],["# Partition Information","",""],["# col_name","data_type","comment"],["okres","string","null"]]},"dateCreated":"2017-03-28T12:51:19+0000","dateStarted":"2017-03-31T13:05:08+0000","dateFinished":"2017-03-31T13:05:08+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:160"},{"title":"Let's join the two datasets to find the count of customers by voivodship","text":"%sql\nselect p.wojewodztwo, count(1) as cnt from bzwbk.klient q join kody p on p.kod = q.kod_pocztowy where q.okres = '1612' group by wojewodztwo order by cnt","user":"user1","dateUpdated":"2017-03-31T13:05:30+0000","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":true,"keys":[{"name":"wojewodztwo","index":0,"aggr":"sum"}],"values":[{"name":"cnt","index":1,"aggr":"sum"},{"name":"cnt","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"wojewodztwo","index":0,"aggr":"sum"},"yAxis":{"name":"cnt","index":1,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/sql","title":true,"tableHide":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490705897889_436872998","id":"20170328-125817_1279974126","result":{"code":"ERROR","type":"TEXT","msg":"Table not found: kody; line 1 pos 68\nset zeppelin.spark.sql.stacktrace = true to see full stacktrace"},"dateCreated":"2017-03-28T12:58:17+0000","dateStarted":"2017-03-31T11:56:25+0000","dateFinished":"2017-03-31T11:56:25+0000","status":"ERROR","progressUpdateIntervalMs":500,"$$hashKey":"object:161"},{"title":"And the same thing in Pyspark","text":"%pyspark\n\nwoj_klient = sqlContext.sql(\"select p.wojewodztwo, count(1) as cnt from bzwbk.klient q join kody p on p.kod = q.kod_pocztowy where q.okres = '1612' group by wojewodztwo order by cnt\")\n\nz.show(woj_klient)   # z -> Zeppelin Context","user":"admin","dateUpdated":"2017-03-28T02:05:58+0000","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":true,"keys":[{"name":"wojewodztwo","index":0,"aggr":"sum"}],"values":[{"name":"cnt","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"wojewodztwo","index":0,"aggr":"sum"},"yAxis":{"name":"cnt","index":1,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/python","title":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490708959219_1617356773","id":"20170328-134919_788191495","dateCreated":"2017-03-28T01:49:19+0000","dateStarted":"2017-03-28T02:05:08+0000","dateFinished":"2017-03-28T02:05:30+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:162"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490858644657_-1327409021","id":"20170330-072404_326654780","dateCreated":"2017-03-30T07:24:04+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:163"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490710989633_-1195662860","id":"20170328-142309_468334375","dateCreated":"2017-03-28T02:23:09+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:164"}],"name":"BZWBK/tutorial","id":"2CEWJGCFX","angularObjects":{"2CEGR7CY3:shared_process":[],"2CEJ2W9WH:shared_process":[],"2CDXVNMGF:shared_process":[],"2CBSWBVMC:shared_process":[],"2CC2KKJ21:shared_process":[],"2CEB2V1JA:shared_process":[]},"config":{"looknfeel":"default"},"info":{}}