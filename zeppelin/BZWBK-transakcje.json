{"paragraphs":[{"text":"%pyspark\n\nimport urllib\n\np = urllib.urlopen('https://www.bzwbk.pl/getCsv.php?id=13&type=csv').read().decode('cp1250')\n\nlines = [line for line in p.split('\\n')[1:]]\n\nprint lines","user":"admin","dateUpdated":"2017-03-31T20:52:51+0000","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490993332967_59421431","id":"20170331-204852_1460696979","dateCreated":"2017-03-31T20:48:52+0000","dateStarted":"2017-03-31T20:52:51+0000","dateFinished":"2017-03-31T20:52:56+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:536","errorMessage":""},{"text":"%pyspark \ndane =  [line.strip().replace(\"\\\"\",\"\").split(\";\") for line in lines]\ndane_dict = [{\"nazwa\":line[0], \"kod\":line[2]} for line in dane[0:-1]]\n\n\nimport pandas\n\npd_placowki = pd.DataFrame(dane_dict)\ndf_placowki = sqlContext.createDataFrame(pd_placowki)\n\ndf_placowki.registerTempTable(\"PLACOWKI\")","user":"admin","dateUpdated":"2017-03-31T20:59:28+0000","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490993598307_-1571176700","id":"20170331-205318_769811948","dateCreated":"2017-03-31T20:53:18+0000","dateStarted":"2017-03-31T20:59:28+0000","dateFinished":"2017-03-31T20:59:28+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:537","errorMessage":""},{"text":"%sql\n\nselect * from PLACOWKI","user":"admin","dateUpdated":"2017-03-31T20:59:31+0000","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490993924350_637173072","id":"20170331-205844_1966644516","dateCreated":"2017-03-31T20:58:44+0000","dateStarted":"2017-03-31T20:59:31+0000","dateFinished":"2017-03-31T20:59:32+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:538","errorMessage":""},{"text":"%pyspark\n\nimport numpy as np\n\nfrom pyspark.mllib.regression import LabeledPoint\nfrom pyspark.mllib.regression import LinearRegressionWithSGD\n\nhc = sqlContext\n\ndf_transakcje = hc.table('bzwbk.transakcje') \n\nkwota_data = df_transakcje.select('data','kwota').groupBy('data').sum('kwota').collect() # run collect() to freeze the results\n\ndf_kwota_data = hc.createDataFrame(kwota_data)\ndf_kwota_data.registerTempTable(\"KWOTA_DATA\")","dateUpdated":"2017-03-30T10:20:01+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490869201167_1803000425","id":"20170327-102039_553298917","dateCreated":"2017-03-30T10:20:01+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:539"},{"text":"%pyspark\n\ndf_rachunki = hc.table('bzwbk.rachunek')\n\ndf_transakcje_wlasne = df_transakcje.join(df_rachunki, df_transakcje.odbiorca == df_rachunki.iban, 'leftsemi')\n\nkwota_data = df_transakcje_wlasne.select('data','kwota').groupBy('data').sum('kwota').collect() # run collect() to freeze the results\n\ndf_kwota_data = hc.createDataFrame(kwota_data)\ndf_kwota_data.registerTempTable(\"KWOTA_DATA_WLASNE\")","dateUpdated":"2017-03-30T10:20:01+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490869201167_1803000425","id":"20170327-054533_809186933","dateCreated":"2017-03-30T10:20:01+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:540"},{"text":"%sql\nselect p.data, p.`sum(kwota)` as wszystkie, q.`sum(kwota)` as wlasne \n  from KWOTA_DATA p join KWOTA_DATA_WLASNE q on p.data=q.data\n  where p.data > '${data_start=2016-01-01}'\n  and p.data < '${data_end=2016-12-31}'\n  order by p.data","dateUpdated":"2017-03-30T10:20:01+0000","config":{"colWidth":12,"editorMode":"ace/mode/sql","graph":{"mode":"multiBarChart","height":300,"optionOpen":true,"keys":[{"name":"data","index":0,"aggr":"sum","$$hashKey":"object:1188"}],"values":[{"name":"wlasne","index":2,"aggr":"sum","$$hashKey":"object:1197"},{"name":"wszystkie","index":1,"aggr":"sum","$$hashKey":"object:1198"}],"groups":[],"scatter":{"xAxis":{"name":"data","index":0,"aggr":"sum"}}},"enabled":true},"settings":{"params":{"data_end":"2016-06-31","data_start":"2016-01-01"},"forms":{"data_end":{"name":"data_end","defaultValue":"2016-12-31","hidden":false},"data_start":{"name":"data_start","defaultValue":"2016-01-01","hidden":false}}},"jobName":"paragraph_1490869201167_1803000425","id":"20170327-102150_2057827006","dateCreated":"2017-03-30T10:20:01+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:541"},{"text":"%pyspark\nprint (df_transakcje_wlasne)","dateUpdated":"2017-03-30T10:20:01+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"data","index":0,"aggr":"sum"}],"values":[{"name":"sum(kwota)","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"data","index":0,"aggr":"sum"},"yAxis":{"name":"sum(kwota)","index":1,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490869201170_1814158143","id":"20170327-094328_466668946","dateCreated":"2017-03-30T10:20:01+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:542"},{"text":"%pyspark\n\nimport json\nimport pandas as pd\n\nfile = open('/var/data/weather/waw-2016.json')\n\np = [ json.loads(line)['daily']['data'][0] for line in file.readlines()]\n\nprint p\n\n\npd_weather = pd.DataFrame(p)\ndf_weather = hc.createDataFrame(pd_weather)\n\nprint df_weather\n\ndf_weather.registerTempTable(\"WEATHER\")","user":"admin","dateUpdated":"2017-03-31T20:46:22+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490869201170_1814158143","id":"20170327-183952_1645061633","dateCreated":"2017-03-30T10:20:01+0000","dateStarted":"2017-03-31T20:46:22+0000","dateFinished":"2017-03-31T20:46:24+0000","status":"ERROR","progressUpdateIntervalMs":500,"$$hashKey":"object:543","errorMessage":""},{"text":"%sql\nselect date_format(to_date(from_unixtime(time)), 'u'), temperatureMin, temperatureMax, `sum(kwota)` from WEATHER JOIN KWOTA_DATA on data = to_date(from_unixtime(time)) order by time","dateUpdated":"2017-03-30T10:20:01+0000","config":{"colWidth":12,"editorMode":"ace/mode/sql","graph":{"mode":"scatterChart","height":300,"optionOpen":true,"keys":[{"name":"_c0","index":0,"aggr":"sum"}],"values":[{"name":"sum(kwota)","index":3,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"_c0","index":0,"aggr":"sum"},"yAxis":{"name":"sum(kwota)","index":3,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490869201170_1814158143","id":"20170327-185318_1792581268","dateCreated":"2017-03-30T10:20:01+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:544"},{"text":"%sql\nselect * from WEATHER","dateUpdated":"2017-03-30T10:20:01+0000","config":{"colWidth":12,"editorMode":"ace/mode/sql","graph":{"mode":"lineChart","height":300,"optionOpen":true,"keys":[{"name":"time","index":18,"aggr":"sum","$$hashKey":"object:1339"}],"values":[{"name":"cloudCover","index":4,"aggr":"sum","$$hashKey":"object:1348"}],"groups":[],"scatter":{"xAxis":{"name":"apparentTemperatureMax","index":0,"aggr":"sum"},"yAxis":{"name":"apparentTemperatureMaxTime","index":1,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490869201173_1811464901","id":"20170328-063347_668651477","dateCreated":"2017-03-30T10:20:01+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:545"},{"text":"%pyspark\n\n#rawdata = sqlContext.sql(\"select `sum(kwota)`, date_format(to_date(from_unixtime(time)), 'u'), temperatureMin, temperatureMax from WEATHER JOIN KWOTA_DATA on data = to_date(from_unixtime(time)) order by time\")\nrawdata = sqlContext.sql(\"select `sum(kwota)` as kwota, date_format(to_date(from_unixtime(time)), 'u') as dzien, temperatureMax, cloudCover, dewPoint, humidity,moonPhase,visibility,windSpeed \"\n\"from WEATHER p JOIN KWOTA_DATA q on data = to_date(from_unixtime(time)) where date_format(to_date(from_unixtime(time)), 'u') in ('6','7')\")","dateUpdated":"2017-03-30T10:20:01+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490869201190_1794151201","id":"20170327-210455_2002160686","dateCreated":"2017-03-30T10:20:01+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:546"},{"text":"%sql\nselect `sum(kwota)` as kwota, date_format(to_date(from_unixtime(time)), 'u') as dzien, temperatureMax, cloudCover, dewPoint, humidity,moonPhase,visibility,windSpeed\nfrom WEATHER p JOIN KWOTA_DATA q on data = to_date(from_unixtime(time)) where date_format(to_date(from_unixtime(time)), 'u') in ('6','7')","dateUpdated":"2017-03-30T10:20:01+0000","config":{"colWidth":12,"editorMode":"ace/mode/sql","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490869201191_1793766452","id":"20170328-171126_1575158629","dateCreated":"2017-03-30T10:20:01+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:547"},{"text":"%sql\nselect `sum(kwota)`, date_format(to_date(from_unixtime(time)), 'u') as day, 'G' as conditions\nfrom WEATHER p JOIN KWOTA_DATA q on data = to_date(from_unixtime(time)) where temperatureMax > 15\nunion all\nselect `sum(kwota)`, date_format(to_date(from_unixtime(time)), 'u') as day, 'B' as conditions\nfrom WEATHER p JOIN KWOTA_DATA q on data = to_date(from_unixtime(time)) where temperatureMax < 15","dateUpdated":"2017-03-30T10:20:01+0000","config":{"colWidth":12,"editorMode":"ace/mode/sql","graph":{"mode":"table","height":300,"optionOpen":true,"keys":[{"name":"sum(kwota)","index":0,"aggr":"sum"}],"values":[{"name":"day","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"day","index":1,"aggr":"sum"},"yAxis":{"name":"sum(kwota)","index":0,"aggr":"sum"},"group":{"name":"conditions","index":2,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490869201193_1791457958","id":"20170328-171942_1574879525","dateCreated":"2017-03-30T10:20:01+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:548"},{"text":"%sql\nselect avg(`sum(kwota)`) as avg_total, stddev(`sum(kwota)`) as stddev_total, date_format(to_date(from_unixtime(time)), 'u') as day\nfrom WEATHER p JOIN KWOTA_DATA q on data = to_date(from_unixtime(time)) where temperatureMax <= 15 and cloudCover >= 0.3\ngroup by  date_format(to_date(from_unixtime(time)), 'u') order by day","dateUpdated":"2017-03-30T10:20:01+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490869201195_1792227456","id":"20170328-172151_363278833","dateCreated":"2017-03-30T10:20:01+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:549"},{"text":"%pyspark\n\n\nfrom pyspark.mllib.stat import Statistics\n\n#x = rawdata.select('sum(kwota)').map(lambda x: x[0])\n#y = rawdata.select('cloudCover').map(lambda x: x[0])\n\nfor col in rawdata.columns[2:]:\n    try:\n        p1 = rawdata.stat.corr('kwota', col)\n        print col, p1\n    except:\n        pass\n    ","dateUpdated":"2017-03-30T10:20:01+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490869201195_1792227456","id":"20170328-094927_938833465","dateCreated":"2017-03-30T10:20:01+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:550"},{"text":"%pyspark\n\nmldata = rawdata.map(lambda row: LabeledPoint(row[0], row[2:]))\n\nprint mldata.collect()[0:10] \n\nmodel = LinearRegressionWithSGD.train(mldata, iterations = 100, step=0.00001, intercept=True)","dateUpdated":"2017-03-30T10:20:01+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490869201196_1790303712","id":"20170327-210723_1634412760","dateCreated":"2017-03-30T10:20:01+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:551"},{"text":"%pyspark\nprint model","dateUpdated":"2017-03-30T10:20:01+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490869201196_1790303712","id":"20170327-212310_184978171","dateCreated":"2017-03-30T10:20:01+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:552"},{"text":"%pyspark\nprint model\n\nvaluesAndPreds = mldata.map(lambda p: (p.label, model.predict(p.features)))\nMSE = valuesAndPreds \\\n    .map(lambda (v, p): (v - p)**2) \\\n    .reduce(lambda x, y: x + y) / valuesAndPreds.count()\nprint(\"Mean Squared Error = \" + str(MSE))\n","dateUpdated":"2017-03-30T10:20:01+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490869201196_1790303712","id":"20170327-211710_1537645225","dateCreated":"2017-03-30T10:20:01+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:553"},{"text":"%pyspark\n\nprint valuesAndPreds.collect()[0:10]","dateUpdated":"2017-03-30T10:20:01+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490869201196_1790303712","id":"20170328-092503_422555013","dateCreated":"2017-03-30T10:20:01+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:554"},{"text":"%pyspark\nfor i in range(7):\n    print model.predict([i])","dateUpdated":"2017-03-30T10:20:01+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490869201196_1790303712","id":"20170327-213240_1656694606","dateCreated":"2017-03-30T10:20:01+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:555"},{"text":"%pyspark\nimport matplotlib.pyplot as plt\nimport StringIO\n\ndef show(p):\n    img = StringIO.StringIO()\n    p.savefig(img, format='svg')\n    img.seek(0)\n    print \"%html <div style='width:600px'>\" + img.buf + \"</div>\"\n\nplt.close()\n\nplt.plot(valuesAndPreds.collect())\n\nshow(plt)","dateUpdated":"2017-03-30T10:20:01+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490869201197_1789918963","id":"20170327-120013_1086226096","dateCreated":"2017-03-30T10:20:01+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:556"},{"dateUpdated":"2017-03-30T10:20:01+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490869201197_1789918963","id":"20170327-130123_2035006289","dateCreated":"2017-03-30T10:20:01+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:557"}],"name":"BZWBK/transakcje","id":"2CCWMVZT6","angularObjects":{"2CEGR7CY3:shared_process":[],"2CEJ2W9WH:shared_process":[],"2CDXVNMGF:shared_process":[],"2CBSWBVMC:shared_process":[],"2CC2KKJ21:shared_process":[],"2CEB2V1JA:shared_process":[]},"config":{"looknfeel":"default"},"info":{}}